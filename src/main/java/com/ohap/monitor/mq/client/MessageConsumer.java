package com.ohap.monitor.mq.client;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jms.annotation.JmsListener;
import org.springframework.messaging.simp.SimpMessagingTemplate;
import org.springframework.stereotype.Component;

@RequiredArgsConstructor
@Slf4j
@Component
public class MessageConsumer {

	private final SimpMessagingTemplate simpMessagingTemplate;

	@JmsListener(destination = "${activemq.queue.name}")
	public void receive(String message) {
		log.info("Received Message '{}'", message);
//		String msg = "{\"content\" : \"" + message + "\"}";
//		String msg = "{'name':'TEAM 1','data':[[1486771200000,47],[1486857600000,46],[1486944000000,20],[1487030400000,19],[1487116800000,16],[1487203200000,55],[1487289600000,29],[1487376000000,38],[1487462400000,21],[1487548800000,25],[1487635200000,34],[1487721600000,40],[1487808000000,12],[1487894400000,39],[1487980800000,50],[1488067200000,37],[1488153600000,28],[1488240000000,35],[1488326400000,36],[1488412800000,44]]},{'name':'TEAM 2','data':[[1486771200000,20],[1486857600000,27],[1486944000000,46],[1487030400000,52],[1487116800000,46],[1487203200000,35],[1487289600000,49],[1487376000000,27],[1487462400000,31],[1487548800000,51],[1487635200000,26],[1487721600000,30],[1487808000000,18],[1487894400000,15],[1487980800000,42],[1488067200000,42],[1488153600000,54],[1488240000000,47],[1488326400000,35],[1488412800000,29]]},{'name':'TEAM 3','data':[[1486771200000,50],[1486857600000,44],[1486944000000,23],[1487030400000,32],[1487116800000,43],[1487203200000,12],[1487289600000,20],[1487376000000,32],[1487462400000,60],[1487548800000,38],[1487635200000,52],[1487721600000,49],[1487808000000,51],[1487894400000,20],[1487980800000,41],[1488067200000,38],[1488153600000,16],[1488240000000,56],[1488326400000,18],[1488412800000,48],[1488499200000,35],[1488585600000,45],[1488672000000,15],[1488758400000,23],[1488844800000,32],[1488931200000,25],[1489017600000,17],[1489104000000,21],[1489190400000,42],[1489276800000,41]]},{'name':'TEAM 4','data':[[1486771200000,17],[1486857600000,47],[1486944000000,25],[1487030400000,26],[1487116800000,43],[1487203200000,16],[1487289600000,31],[1487376000000,15],[1487462400000,48],[1487548800000,10]]},{'name':'TEAM 5','data':[[1486771200000,57],[1486857600000,58],[1486944000000,42],[1487030400000,21],[1487116800000,29],[1487203200000,41],[1487289600000,47],[1487376000000,45],[1487462400000,51],[1487548800000,49],[1487635200000,59],[1487721600000,30],[1487808000000,41],[1487894400000,57],[1487980800000,10],[1488067200000,51],[1488153600000,36],[1488240000000,57],[1488326400000,45],[1488412800000,41],[1488499200000,43],[1488585600000,52],[1488672000000,17],[1488758400000,37],[1488844800000,27],[1488931200000,58],[1489017600000,27],[1489104000000,52],[1489190400000,29],[1489276800000,22]]}";
		this.simpMessagingTemplate.convertAndSend("/chart", message); //메시지 전송
	}
}
